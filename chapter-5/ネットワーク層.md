# ここがkey

## コンピュータの住所
ネットワーク層では、役割の中心となるプロトコルが一つしかない。
それが**IP(インターネットプロトコル)**。

IPの通信では、宛先の機器を特定するためにIPアドレスと呼ばれる固有の数字を使う。
現在広く利用されているIPではIPアドレスを32ビットで表す。(IPv4の場合)

通常はそれを8ビットごとにピリオドで区切り、10進数にして「192.168.15.10」というように表記する。
手紙を書くときに封筒に宛先の住所を書くように、ネットワーク層ではヘッダにIPアドレスを書き込む。

IPアドレスは、住所で言う「町名」までにあたる「ネットワーク部」と「番地」に当たる「ホスト部」から成り立っている。
しかし、一見しただけではどこまでがネットワーク部でどこまでがホスト部かということはわからない。

そこで、両者の境目を示すために**サブネットマスク**という仕組みを使う。


# ネットワーク層の役割

## ネットワーク層の位置づけ
他の層と違い、主となるプロトコルはIP人るしか無い

## 通信手段の違いを埋める
ネットワーク層には、通信手段の違いを吸収する働きがある(ある意味緩衝材のようなもの)。
これにより、通信手段の異なるネットワーク上にあるコンピュータ同士でもやり取りができるようになる。

## 通信相手を特定する
ネットワーク層では「誰が誰に届けるのか」という、通信に置いていちばん大事な情報を扱う。
通信相手を特定するために、ネットワーク上に存在する全ての機器には固有の住所のようなものが割り振られている。

## 宛先までの経路を決める
宛先のコンピュータまでの経路は、1つだけとは限らない。
宛先までの経路が複数ある場合に、適切なルートを使って届けるのもネットワーク層の役割。

# IPプロトコル

## データリンク層へ渡す
送信側では、トランスポート層からデータを受け取り、宛先を特定する番号(IPアドレス)などを書き込んだIPヘッダをつけて、データリンク層に渡す。
データにIPヘッダを付けたものを**IPデータグラム**という。

## ベストエフォートのデータ転送
IPのデータ転送は、**ベストエフォート方式**。
ベストエフォート: 努力はするが、結果の保証はしない。という意味
ヘッダが壊れていないかのチェックや宛先の住所が存在しないと判断したときの対応はするが、再送処理は行わない。

## 最適な経路で送る
IPには、宛先までの道のりや通信状況などから、そのときに最も早く宛先に届くにはどの経路が良いかを判断し、送り出すという働きがある。

## トランスポート層へ渡す
受信側では、IPヘッダに書かれた宛先の住所(IPアドレス)を確認して、自分宛てのときだけ受け取る。
そして、トランスポート層の指定されたプロトコルに渡す。

# IPアドレス(IPv4)

## IPアドレスとIPv4
IPアドレスは、ネットワーク上の機器を区別するための番号。
従来から使われてきたIPv4と新しいIPv6がある。

|ネットワーク部|ネットワーク部|ホスト部|ホスト部|
--|--|--|--
|11000000|10101000|00001111|00001010|
|192.|168.|15.|10.|

ネットワーク部: ネットワーク固有の番号が入る

ホスト部: 個々のコンピュータを表す番号が入る。基本的に自由に割り振れる(全て0または1を除く)

通常は8ビットずつピリオドで区切り、10進数で表す。
同じネットワーク内ならネットワーク部は同じ。

全く同じアドレスを持つコンピュータが複数台存在したら「コンピュータを特定する」という目的は果たせない。
そこで、番号の重複を防ぐためにICANNという機関が中心となって世界中のIPアドレスを管理している。

## ネットワーク部とホスト部の境目
IPアドレスだけでは、ネットワーク部とホスト部の境目がわからない。
そこで、**サブネットマスク**(又はマスク)と呼ばれる値を使って境目を示す。

IPアドレス
|192.|168.|15.|10|
--|--|--|--
|ネットワーク部|ネットワーク部|ホスト部|ホスト部|
|11000000|10101000|00001111|00001010|

サブネットマスク
|255.|255.|0.|0.|
--|--|--|--
|ネットワーク部|ネットワーク部|ホスト部|ホスト部|
|11111111|11111111|00000000|00000000|

ネットワーク部に対応するビットを1にする。

通常、IPアドレスとサブネットマスクは以下の様に表記し、ペアで利用する。

IPアドレス |192.|168.|15.|10|
サブネットマスク|255.|255.|0.|0.=|

また、IPアドレスとサブネットマスクを次のようにまとめて書くこともできる。

192.168.15.10 / 16

IPアドレスのあとに/(バックスラッシュ)とネットワーク部のビット数を書く

**注意**
境目は、8ビットの区切りと一致しないこともある。
