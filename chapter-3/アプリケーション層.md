# アプリケーション層の役割

## アプリケーション層の位置づけ
TCP/IPの5階層のうち、一番上に位置するのがアプリケーション層。
コンピュータ同士のやり取りを、ユーザーが利用できる「通信サービス」という形にするのがこの層の役割

## 通信サービスの実現
アプリケーション層の役割は、通信サービスを実現するということ。
この層は「送信側と受信側」ではなく、「クライアントとサーバー」という概念を持っている

## アプリケーションプロトコル
アプリケーションプロトコル: 通信サービスにおけるサーバーとクライアントのやり取りを定めたプロトコル
アプリケーションプロトコルは「サービスを実現するにはどんなやり取りをすれば効率的か」を考えて作られている。
そのため、電子メールやWWW等、サービスの数だけアプリケーションプロトコルが存在している。

# アプリケーションヘッダ
アプリケーションヘッダ: アプリケーション層で付加されるヘッダ
ここには、サービスを実現するために最も重要な「要求と応答」に関する情報が書き込まれる
下の層に進むとヘッダとデータがひとくくりにされてしまうため、データがユーザーに解釈できる形になっているのはこの層だけ
(カプセル化によりデータそのものは解読できない)

## テキストベースとバイナリベース
アプリケーションヘッに何をドノように書き込むかは、プロトコルによって異なる。
また、人が読める言葉(テキストベース)で書かれる場合とコンピュータが処理しやすい言葉(バイナリベース)で書かれる場合がある。

## ヘッダだけを送る
クライアントからサーバーへサービスを要求するときなど、具体的なデータのやり取りがなく連絡を取り合うだけのときは、データ部分の空の状態で送る。

# HTTPプロトコル
## やり取りの手順
HTTPプロトコルは1つの要求に対して1つの応答を返すとてもシンプルなプロトコル
実際には、ページを構成しているファイルの数だけ、この作業を繰り返す

### やり取り
TCP通信の確立
クライアント「home/index.htmlをください」（要求)
サーバー「はい、どうぞ」(応答)
クライアント: 受け取ったHTMLファイルを表示する
TCP通信の切断
TCP通信の確立
クライアント「home/index.gifをください」（要求)
サーバー「はい、どうぞ」(応答)
クライアント: 受け取った画像ファイルを表示する
TCP通信の切断

## 要求パケットと応答パケット
HTMLプロトコルでは、「要求」と「応答」という2種類のパケットを使って、テキスト形式でやり取りを行う

### 要求パケット
クライアントがサーバーに送るパケット

メソッド: 要求の種類。GETの他にPUT等がある
要求ヘッダ: サーバーへ伝えるクライアントの情報。項目名と情報は;で区切る
空白: ヘッダとボディの境界を示す
ボディ: 要求時に必要なデータが入る。メソッドがGETの場合は、空になる

### 応答パケット
サーバーがクライアントに送るパケット

ステータス行: クライアントからの要求に対する処理と結果。正常に処理できたときは200番台の数字に鳴る
応答ヘッダ: クライアントにわたすデータに関する情報
空白: ヘッダとボディの境界を示す
ボディ: クライアントにわたすデータが入る

# 通信を維持する仕組み(1)
HTTPプロトコルは、接続状態を保ったままやり取りを続けることができない

## HTTPプロトコルは1回完結
HTTPプロトコルはもともと「要求されたデータを返すこと」だけを目的に作られた。
そのため、1回の要求と応答で通信は完結し、過去に行った通信と関連付けられることはない。

1. HTMLファイルのダウンロード
    通信の確立
    要求
    応答
    通信の切断
2. 画像1ファイルのダウンロード
    通信の確立
    要求
    応答
    通信の切断
上記、１と２はそれぞれ独立している。

このような１回完結のプロトコルを**ステートレスプロトコル**という。
最近では、ネットショッピング等、ステートレスでは対応しきれないサービスも増えてきている。

## Cookie
HTTPプロトコルのやり取りに関する情報をクライアント側に保存し、次の通信時にその情報をサーバーに提示すると、サーバーはユーザーを特定し、前回からの続きの通信として扱える。
このときやり取りされる情報を**Cookie**という。
CookieはHTTPプロトコルの正規の仕組みではない。
Cookieは普通はCGI(Common Gateway Interface)などクライアントからの要求に応じてwebページを作成する仕組みと組み合わせて使う。

# 通信を維持する仕組み(2)
## CGIを使うとここが違う

### 通常のWebページの場合
サーバーが応答パケットを用意する
サーバーは予め保管しているWebページを返すだけ。

### CGIを使った場合
サーバーからの要求を受けて、CGIプログラムが応答パケットを用意する。
このとき、クッキーを利用する場合は。ヘッダ部分にクッキーと「クライアントにクッキーを保存させるためのコマンド」を書き込む

# SSL/TLS
## SSL(Secure Sockets Layer)とTLS(Transport Layer Security)
SSL: インターネット上でデータの通信を暗号化するためのプロトコル
TLS: SSLをもとに標準化したもの
SSLという名称が普及しているため、SSL/TLSと併記されることも多い

### 確認方法
ブラウザで表示したwebページがSSL/TLSで保護されているかどうかは、次のようにして確認できる
- アドレスバー等に鍵マークが表示されている
- URLが「https」から始まる(sはsecureを表す)
(HTTPとHTTPSでは異なるポートを使用する)
